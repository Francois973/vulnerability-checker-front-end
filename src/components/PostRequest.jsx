import React, { useState } from "react";
import { BsClipboardCheck } from "react-icons/bs";
import { useCopyToClipboard } from "usehooks-ts";

const PostRequest = () => {
  const [copiedIndex, setCopiedIndex] = useState(-1);
  const [value, copy] = useCopyToClipboard();

  const result = {
    name: "vulnerability-checker-back-end",
    uuid: "556cbd7c-241f-4aed-a490-a8b544bdf9b6",
    status: "New",
    url: "https://github.com/francois973/vulnerability-checker-back-end",
    ecosystems: {
      RUST: "pending",
      ERLANG: "pending",
      RUBYGEMS: "pending",
      NPM: "pending",
    },
    created_at: "2023-03-11T15:42:42.746Z",
    vulnerabilities: [],
  };

  const url = "https://api.scanrepo.fr/api/v1/projects";

  const params =
    "name: project_name, url:https://github.com/francois973/:project-name";

  const jsonResult = JSON.stringify(result, null, 2);

  const handleClick = (index, value) => {
    setCopiedIndex(index);
    copy(value);
  };

  return (
    <div className="py-5">
      <p>
        In this first part, we have to inform the api about a repository also
        called "Project". For that, we have to make a "POST" type of request so
        that it can keep in memory an identification number which will allow us
        later to find its vulnerabilities.
      </p>
      <pre className="p-4 rounded-sm bg-dark-github flex sm:flex-row flex-col justify-between items-center mt-5 sm:overflow-hidden overflow-auto">
        <code className="value text-[14px] w-96">
          https://api.scanrepo.fr/api/v1/projects
        </code>
        <div className="flex flex-col items-center">
          <BsClipboardCheck
            className="text-right cursor-pointer hover:bg-slate-600"
            onClick={() => handleClick(0, url)}
          />
          <p className="text-[10px]">{copiedIndex === 0 ? "Copied!" : ""}</p>
        </div>
      </pre>
      <div className="mt-5">
        <p>We need to add some params :</p>
        <pre className="p-4 rounded-sm bg-dark-github flex sm:flex-row flex-col justify-between items-center mt-5  sm:overflow-hidden overflow-auto">
          <code className="value text-[14px]">
            name: "project-name", url:
            "https://github.com/:username/:project-name"
          </code>
          <div className="flex flex-col items-center">
            <BsClipboardCheck
              className="text-right cursor-pointer hover:bg-slate-600"
              onClick={() => handleClick(1, params)}
            />
            <p className="text-[10px]">{copiedIndex === 1 ? "Copied!" : ""}</p>
          </div>
        </pre>

        <div className="mt-5 mb-6">
          <p>Exemple JSON of result :</p>
          <pre className="p-4 rounded-sm bg-dark-github flex sm:flex-row flex-col justify-between items-start mt-5 sm:overflow-hidden overflow-auto">
            <code className="value text-[14px]">
              {JSON.stringify(result, null, 2)}
            </code>
            <div className="flex flex-col items-center">
              <BsClipboardCheck
                className="text-right cursor-pointer hover:bg-slate-600"
                onClick={() => handleClick(2, jsonResult)}
              />
              <p className="text-[10px]">
                {copiedIndex === 2 ? "Copied!" : ""}
              </p>
            </div>
          </pre>
        </div>
      </div>
    </div>
  );
};

export default PostRequest;
