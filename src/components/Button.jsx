import React from "react";
import { useForm } from "react-hook-form";
import { useNavigate } from "react-router-dom";
import { apiBaseUrl } from "../utils/config";

const Button = ({ url, languages }) => {
  const LANGUAGES_AVAILABLES = ["Ruby", "JavaScript", "Elixir", "Rust"];

  const isActive = LANGUAGES_AVAILABLES.includes(Object.keys(languages)[0]);

  const navigate = useNavigate();
  const { register, handleSubmit } = useForm();
  const onSubmit = async (data) => {
    try {
      const response = await fetch(`${apiBaseUrl}/projects`, {
        method: "POST",
        credentials: "include",
        headers: {
          "Content-type": "application/json",
        },
        body: JSON.stringify({ project: data }),
      });

      const project = await response.json();
      if (!response.ok) {
        return;
      }
      navigate(`/project/${project.uuid}`);
    } catch {}
  };
  return (
    <div className="w-full md:w-fit">
      <form
        onSubmit={handleSubmit(onSubmit)}
        className="flex flex-col gap-y-5 items-center"
      >
        <input type="hidden" name="action" value={url} {...register("url")} />

        <input
          type="submit"
          value={`${isActive ? "Scan" : "Unavailable"}`}
          disabled={!isActive}
          className={`${
            isActive
              ? "cursor-pointer bg-gradient-to-r from-purple-400 to-pink-600 font-bold p-2 rounded-md hover:opacity-60 transition ease-in-out delay-50 text-center w-full md:w-fit"
              : "text-gray-600 border-gray-600 w-fit rounded-md"
          }


          `}
        />
      </form>
    </div>
  );
};

export default Button;
